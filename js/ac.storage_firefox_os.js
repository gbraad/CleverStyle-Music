// Generated by CoffeeScript 1.9.3

/**
 * @package   CleverStyle Music
 * @category  app
 * @author    Nazar Mokrynskyi <nazar@mokrynskyi.com>
 * @copyright Copyright (c) 2014-2015, Nazar Mokrynskyi
 * @license   MIT License, see license.txt
 */

(function() {
  var music_storage;

  if (!navigator.getDeviceStorage) {
    return;
  }

  music_storage = navigator.getDeviceStorage('music');

  cs.storage.scan = function(callback) {
    var cursor, files;
    files = [];
    cursor = music_storage.enumerate();
    cursor.onsuccess = (function(_this) {
      return function() {
        var file;
        if (cursor.result) {
          file = cursor.result;
          if (_this.known_extensions.indexOf(file.name.split('.').pop()) !== -1) {
            files.push(file.name);
          }
          return cursor["continue"]();
        } else {
          return callback(files);
        }
      };
    })(this);
    return cursor.onerror = function() {
      return console.error(this.error.name);
    };
  };

  cs.storage.get = function(filename, success_callback, error_callback) {
    var result;
    if (error_callback == null) {
      error_callback = function() {};
    }
    result = music_storage.get(filename);
    result.onsuccess = function() {
      if (this.result) {
        return success_callback(this.result);
      }
    };
    return result.onerror = error_callback;
  };

}).call(this);
